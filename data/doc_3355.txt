https://en.wikipedia.org/wiki/ISO-TP

From Wikipedia, the free encyclopedia (Redirected from ISO-TP ) CAN-FD International car standard This article needs additional citations for verification . Please help improve this article by adding citations to reliable sources . Unsourced material may be challenged and removed. Find sources: "ISO 15765-2" – news · newspapers · books · scholar · JSTOR ( June 2019 ) ( Learn how and when to remove this message ) ISO 15765-2 , [ 1 ] or ISO-TP (Transport Layer) , is an international standard for sending data packets over a CAN bus . [ 2 ] The protocol allows for the transport of messages that exceed the eight byte maximum payload of CAN frames . ISO-TP segments longer messages into multiple frames, adding metadata (CAN-TP Header) that allows the interpretation of individual frames and reassembly into a complete message packet by the recipient. It can carry up to 2 32 -1 (4294967295) bytes of payload per message packet starting from the 2016 version. [ 2 ] Prior versions were limited to a maximum payload size of 4095 bytes. In the OSI model , ISO-TP covers the layer 3 (network layer) and 4 (transport layer). The most common application for ISO-TP is the transfer of diagnostic messages with OBD-II equipped vehicles using KWP2000 and UDS , but is used broadly in other application-specific CAN implementations where one might need to send messages longer than what the CAN protocol physical layer allows (eight bytes for CAN, 64 bytes for CAN FD, and 2048 bytes for CAN-XL). ISO-TP can be operated with its own addressing as so-called Extended Addressing or without address using only the CAN ID (so-called Normal Addressing ). Extended addressing uses the first data byte of each frame as an additional element of the address, reducing the application payload by one byte.  For clarity the protocol description below is based on Normal Addressing with eight byte CAN frames. In total, six types of addressing are allowed by the ISO 15765-2 Protocol. ISO-TP prepends one or more metadata bytes to the payload data in the eight byte CAN frame, reducing the payload to seven or fewer bytes per frame. The metadata is called the Protocol Control Information, or PCI. The PCI is one, two or three bytes. The initial field is four bits indicating the frame type, and implicitly describing the PCI length. ISO 15765-2 is a part of ISO 15765 (headlined Road vehicles — Diagnostic communication over Controller Area Network (DoCAN) ), which has the following parts: ISO 15765-1  Part 1: General information and use case definition ISO 15765-2  Part 2: Transport protocol and network layer services ISO 15765-3  Part 3: Implementation of unified diagnostic services (UDS on CAN) – replaced by ISO 14229-3 Road vehicles — Unified diagnostic services ISO 15765-4  Part 4: Requirements for emissions-related systems List of protocol control information (PCI) field types [ edit ] The ISO-TP defines four frame types: Type PCI Code Description Single frame (SF) 0 The single frame transferred contains the complete payload of up to 7 bytes (normal addressing) or 6 bytes (extended addressing) First frame (FF) 1 First frame of a multi-frame packet, used when greater than 6/7 data bytes are to be communicated. The first frame contains the length of the full packet and the initial data. Consecutive frame (CF) 2 A frame containing subsequent data for a multi-frame packet Flow control frame (FC) 3 Response from the receiver, acknowledging a start of a multi-frame packet. Used to manage the pace of the consecutive frames. CAN-TP Header Byte0 Byte1 Byte2 Byte3 Byte4 Byte5 Byte6 Byte7 High Nibble Low Nibble Full Byte (0x00-0xFF) Full Byte (0x00-0xFF) Full Byte (0x00-0xFF) " " " " Single 0x0 Length (0x0..0x7) Data A Data B Data C ... ... ... ... First 0x1 Length (0x008..0xFFF) Data A Data B ... ... ... ... Consecutive 0x2 Index (0x0..0xF) Data A Data B Data C ... ... ... ... Flow Cntl 0x3 FC Flag (0x0,0x1,0x2) Block Size STmin ... ... ... ... ... A message of seven bytes or less is sent in a single frame, with the initial byte containing the type (0) and payload length (1-7 bytes). With the 0 in the type field, this can also pass as a simpler protocol with a length-data format and is often misinterpreted as such. A message longer than 7 bytes requires segmenting the message packet over multiple frames.  A segmented transfer starts with a First Frame.  The PCI is two bytes in this case, with the first 4 bit field the type (type 1) and the following 12 bits the message length (excluding the type and length bytes).  The recipient confirms the transfer with a flow control frame. The flow control frame has three PCI bytes specifying the interval between subsequent frames and how many consecutive frames may be sent ( Block Size ). For CAN FD, the ISO 15765-2 protocol has been extended for Single and First frame, to allow larger size values, but still backwards compatible with traditional ISO 15765. See CAN FD . Flow Control Frame Fields and Functions Byte0 Byte1 Byte2 Byte3 Byte4 Byte5 Byte6 Byte7 High Nibble Low Nibble Full Byte (0x00-0xFF) Full Byte (0x00-0xFF) Padding " " " " Description Flow Status Block Size Separation Time (ST), minimum delay time between frames (end of one frame and the beginning of the other) Single 0x3 0 = Cont. to Send 1 = Wait 2 = Overflow/abort 0 = remaining "frames" to be sent without flow control or delay <= 127 (0x00 to 0x7F), separation time in milliseconds. 0x00 0x00 0x00 0x00 0x00 Single 0x3 0 = Cont. to Send 1 = Wait 2 = Overflow/abort > 0 send number of "frames" before waiting for the next flow control frame 0xF1 to 0xF9 UF (100-900 μs). 0x00 0x00 0x00 0x00 0x00 CAN-TP Multi-Frame Message Example (15 byte message packet) Message Direction Frame Type Data Bytes (Hex Format) Interpretation Sending Frame 1 10 0F 11 22 33 44 55 66 PCI Code = 0x1, length of entire message = 0x00F, first 6 bytes of data Receiving Flow Control 30 00 00 00 00 00 00 00 PCI Code = 0x3, 0x0 = continue, no delay, padding Sending Frame 2 21 77 88 99 AA BB CC DD PCI Code = 0x2, msg. index = 0x1, next 7 bytes of data Sending Frame 3 22 EE FF PCI Code = 0x2, msg. index = 0x2, final 2 bytes of data The initial byte contains the type (type = 3) in the first four bits, and a flag in the next four bits indicating if the transfer is allowed (0 = Continue To Send, 1 = Wait, 2 = Overflow/abort).  The next byte is the block size, the count of frames that may be sent before waiting for the next flow control frame.  A value of zero allows the remaining frames to be sent without flow control or delay. The third byte is the minimum Separation Time (STmin), the minimum delay time between frames. STmin values up to 127 (0x7F) specify the minimum number of milliseconds to delay between frames, while values in the range 241 (0xF1) to 249 (0xF9) specify delays increasing from 100 to 900 microseconds.  Note that the Separation Time is defined as the minimum time between the end of one frame to the beginning of the next. Robust implementations should be prepared to accept frames from a sender that misinterprets this as the frame repetition rate i.e. from start-of-frame to start-of-frame. Even careful implementations may fail to account for the minor effect of bit-stuffing in the physical layer. The sender transmits the rest of the message using Consecutive Frames. Each Consecutive Frame has a one byte PCI, with a four bit type (type = 2) followed by a 4-bit sequence number.  The sequence number starts at 1 and increments with each frame sent (1, 2,..., F, 0, 1,...), with which lost or discarded frames can be detected.
Each consecutive frame starts at 0, initially for the first set of data in the first frame will be considered as 0th data. So the first set of CF(Consecutive frames) start from 0x1. There afterwards when it reaches 0x2F, will be started from 0x20 (e.g. 0x21, 0x22, 0x23...0x2F, 0x20, 0x21...). 
The 12-bit length field (as indicated in the First Frame) allows up to 4095 bytes of user data in a segmented message, but in practice the typical application-specific limit is considerably lower because of receive buffer or hardware limitations. Timing parameters [ edit ] Timing parameters, such as P1 and P2 timers, have to be mentioned. Standards [ edit ] ISO 15765-2:2016 Road vehicles -- Diagnostic communication over Controller Area Network (DoCAN) -- Part 2: Transport protocol and network layer services Additional Further Readings [ edit ] https://netcult.ch/elmue/HUD%20ECU%20Hacker/ISO%2015765-2.pdf https://www.cheapbills.com.au/blog/iso-tp-iso-15765-2-explained References [ edit ] ^ "ISO 15765-2:2016" . ISO . Retrieved 2019-04-05 . ^ a b "ISO 15765-2 (ISO-TP) — The Linux Kernel documentation" . docs.kernel.org . Retrieved 2025-09-12 . Retrieved from " https://en.wikipedia.org/w/index.php?title=ISO_15765-2&oldid=1322842212 " Category : Computer networks Hidden categories: Articles with short description Short description is different from Wikidata Articles needing additional references from June 2019 All articles needing additional references